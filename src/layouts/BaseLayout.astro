---
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
}

const { 
  title = 'MoonTax - Expert Crypto Tax Reconciliation & Data Cleaning',
  description = 'Stop worrying about messy crypto data. We decode complex blockchain transactions, reconcile years of trading chaos, and deliver IRS-compliant reports. Reconciled over $1B in transactions.'
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content={description}>
    <title>{title}</title>

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="https://pub-3cbce51aade14e919d73718554ff4a17.r2.dev/favicon%20(3)/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="https://pub-3cbce51aade14e919d73718554ff4a17.r2.dev/favicon%20(3)/favicon.svg" />
    <link rel="shortcut icon" href="https://pub-3cbce51aade14e919d73718554ff4a17.r2.dev/favicon%20(3)/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="https://pub-3cbce51aade14e919d73718554ff4a17.r2.dev/favicon%20(3)/apple-touch-icon.png" />
    <link rel="manifest" href="https://pub-3cbce51aade14e919d73718554ff4a17.r2.dev/favicon%20(3)/site.webmanifest" />
    
    <!-- Preconnect to font providers for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Load fonts with display=swap for better performance -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Defer non-critical scripts -->
    <script src="https://unpkg.com/lucide@latest" defer></script>
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js" defer></script>
</head>

<body class="bg-black text-white antialiased overflow-x-hidden selection:bg-orange-500/30 selection:text-orange-200">
    <!-- Background (Unicorn Studio Animation - Fixed) -->
    <div class="fixed top-0 left-0 w-screen h-screen brightness-50 opacity-40 saturate-0 z-0 pointer-events-none" style="mask-image: linear-gradient(to bottom, transparent, black 0%, black 80%, transparent); -webkit-mask-image: linear-gradient(to bottom, transparent, black 0%, black 80%, transparent); transform: translateZ(0); -webkit-transform: translateZ(0);">
        <div class="absolute inset-0 -z-10">
            <!-- Unified Animation (Mobile & Desktop) -->
            <div data-us-project="bKN5upvoulAmWvInmHza" class="absolute inset-0 -z-20"></div>
            <script type="text/javascript" is:inline>
                !function(){if(!window.UnicornStudio){window.UnicornStudio={isInitialized:!1};var i=document.createElement("script");i.src="https://cdn.jsdelivr.net/gh/hiunicornstudio/unicornstudio.js@v1.4.29/dist/unicornStudio.umd.js",i.onload=function(){window.UnicornStudio.isInitialized||(UnicornStudio.init(),window.UnicornStudio.isInitialized=!0)},(document.head || document.body).appendChild(i)}}();
            </script>
        </div>
    </div>

    <!-- Progressive Blur Top (Removed - was causing text blur) -->
    <!-- <div class="gradient-blur">
        <div></div><div class=""></div><div></div><div class=""></div><div></div><div></div>
    </div> -->

    <slot />

    <!-- Tracking Script -->
    <script is:inline>
        (function() {
            // Skip tracking script on scheduling page to avoid interfering with GHL iframe
            if (window.location.pathname.includes('/scheduling')) {
                return;
            }
            
            // Capture and persist tracking parameters
            const urlParams = new URLSearchParams(window.location.search);
            const trackingParams = [
                'utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content',
                'gclid', 'fbclid', 'msclkid', 'ttclid', 'li_fat_id'
            ];
            
            const data = JSON.parse(sessionStorage.getItem('moontax_tracking') || '{}');
            
            // Capture UTMs and Click IDs
            trackingParams.forEach(param => {
                if (urlParams.has(param)) {
                    data[param] = urlParams.get(param);
                }
            });
            
            // Capture Referrer (only if not from our own site)
            if (document.referrer && !document.referrer.includes(window.location.hostname)) {
                if (!data.referring_url) {
                    data.referring_url = document.referrer;
                }
            }
            
            // Always capture entry URL if not set
            if (!data.entry_url) {
                data.entry_url = window.location.href;
            }
            
            sessionStorage.setItem('moontax_tracking', JSON.stringify(data));
        })();
    </script>

    <script is:inline>
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    </script>
</body>
</html>

